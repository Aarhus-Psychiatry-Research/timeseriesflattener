<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="Advanced Tutorial" />
<meta property="og:type" content="website" />
<meta property="og:url" content="tutorials/02_advanced.html" />
<meta property="og:site_name" content="timeseriesflattener" />
<meta property="og:description" content="In the basic tutorial we covered how to add static features, predictors and outcomes. In this tutorial, we’ll expand on that, covering how to effectively add many features by: Creating feature comb..." />
<meta property="og:image:width" content="1146" />
<meta property="og:image:height" content="600" />
<meta property="og:image" content="/_images/social_previews/summary_tutorials_02_advanced_537d1dc6.png" />
<meta property="og:image:alt" content="In the basic tutorial we covered how to add static features, predictors and outcomes. In this tutorial, we’ll expand on that, covering how to effectively add..." />
<meta name="description" content="In the basic tutorial we covered how to add static features, predictors and outcomes. In this tutorial, we’ll expand on that, covering how to effectively add many features by: Creating feature comb..." />
<meta name="twitter:card" content="summary_large_image" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Adding text features" href="03_text.html" /><link rel="prev" title="Introductory Tutorial" href="01_basic.html" />

    <link rel="shortcut icon" href="../_static/favicon.ico"/><!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Advanced Tutorial - Timeseriesflattener</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #ff5454;
  --color-brand-content: #ff7575;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ff8f8f;
  --color-brand-content: #ff8f8f;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #ff8f8f;
  --color-brand-content: #ff8f8f;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Timeseriesflattener</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/icon.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/icon_dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Timeseriesflattener</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_basic.html">Introductory Tutorial</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Advanced Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_text.html">Adding text features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../feature_specifications.html">Feature specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseriesflattener.html">Timeseriesflattener</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Changelog</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Aarhus-Psychiatry-Research/timeseriesflattener/blob/main/CHANGELOG.md">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GitHub</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Aarhus-Psychiatry-Research/timeseriesflattener">GitHub Repository</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/Aarhus-Psychiatry-Research/timeseriesflattener/edit/main/docs/tutorials/02_advanced.ipynb" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="advanced-tutorial">
<h1>Advanced Tutorial<a class="headerlink" href="#advanced-tutorial" title="Permalink to this heading">#</a></h1>
<p>In the basic tutorial we covered how to add static features, predictors and outcomes.
In this tutorial, we’ll expand on that, covering how to effectively add many features by:</p>
<ol class="arabic simple">
<li><p>Creating feature combinations from specifications,</p></li>
<li><p>Using caching, so you can iterate on your datasets without having to complete full computations every time</p></li>
</ol>
<section id="creating-feature-combinations">
<h2>Creating feature combinations<a class="headerlink" href="#creating-feature-combinations" title="Permalink to this heading">#</a></h2>
<p>Manually specifying a handful of features one at a time is rather straightforward, but what if you want to generate hundreds of features? Or want to have multiple different lookbehind windows, e.g. a month, 6 months and a year? Then the amount of code you’ll have to write will grow quite substantially and becomes time consuming and hard to navigate.</p>
<p>To solve this problem, we implemented feature group specifications. They allow you to combinatorially create features. Let’s look at an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">timeseriesflattener.feature_specs.group_specs</span> <span class="kn">import</span> <span class="n">PredictorGroupSpec</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.aggregation_fns</span> <span class="kn">import</span> <span class="n">maximum</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.testing.load_synth_data</span> <span class="kn">import</span> <span class="n">load_synth_predictor_float</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.feature_specs.group_specs</span> <span class="kn">import</span> <span class="n">NamedDataframe</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.aggregation_fns</span> <span class="kn">import</span> <span class="n">mean</span><span class="p">,</span> <span class="n">maximum</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pprint</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/.local/lib/python3.10/site-packages/pydantic/_internal/_config.py:321: UserWarning: Valid config keys have changed in V2:
* &#39;allow_mutation&#39; has been removed
  warnings.warn(message, UserWarning)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_spec_batch</span> <span class="o">=</span> <span class="n">PredictorGroupSpec</span><span class="p">(</span>
    <span class="n">named_dataframes</span><span class="o">=</span><span class="p">[</span>
        <span class="n">NamedDataframe</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">load_synth_predictor_float</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;synth_predictor_float&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">lookbehind_days</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">365</span><span class="p">),</span> <span class="p">(</span><span class="mi">365</span><span class="p">,</span> <span class="mi">730</span><span class="p">),</span> <span class="mi">1095</span><span class="p">],</span>
    <span class="n">fallback</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="n">aggregation_fns</span><span class="o">=</span><span class="p">[</span><span class="n">mean</span><span class="p">,</span> <span class="n">maximum</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">create_combinations</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You’ll note that:</p>
<ol class="arabic simple">
<li><p>All attributes are now required to be lists. This makes iteration easier when creating the combinations.</p></li>
<li><p>We require a named_dataframes sequence. A namedataframe is exactly that; a dataframe and a name. This is used when we create the features in the output, e.g. for a predictor, the output feature using load_synth_predictor_flaot will be called pred_synth_predictor_float_<metadata> because that’s the name attributed in the NamedDataframe.</p></li>
</ol>
<p>Let’s check that the results look good.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a small summary to highlight the generated predictors</span>
<span class="n">pred_spec_batch_summary</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;feature_name&quot;</span><span class="p">:</span> <span class="n">pred_spec</span><span class="o">.</span><span class="n">feature_base_name</span><span class="p">,</span>
        <span class="s2">&quot;lookbehind_days&quot;</span><span class="p">:</span> <span class="n">pred_spec</span><span class="o">.</span><span class="n">lookbehind_period</span><span class="p">,</span>
        <span class="s2">&quot;aggregation_fn&quot;</span><span class="p">:</span> <span class="n">pred_spec</span><span class="o">.</span><span class="n">aggregation_fn</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">pred_spec</span> <span class="ow">in</span> <span class="n">pred_spec_batch</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;––––––––– We created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_spec_batch</span><span class="p">)</span><span class="si">}</span><span class="s2"> combinations of predictors. ––––––––––&quot;</span>
<span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">pred_spec_batch_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>––––––––– We created 6 combinations of predictors. ––––––––––
[{&#39;aggregation_fn&#39;: &#39;mean&#39;,
  &#39;feature_name&#39;: &#39;synth_predictor_float&#39;,
  &#39;lookbehind_days&#39;: LookPeriod(min_days=0.0, max_days=365.0)},
 {&#39;aggregation_fn&#39;: &#39;maximum&#39;,
  &#39;feature_name&#39;: &#39;synth_predictor_float&#39;,
  &#39;lookbehind_days&#39;: LookPeriod(min_days=0.0, max_days=365.0)},
 {&#39;aggregation_fn&#39;: &#39;mean&#39;,
  &#39;feature_name&#39;: &#39;synth_predictor_float&#39;,
  &#39;lookbehind_days&#39;: LookPeriod(min_days=365.0, max_days=730.0)},
 {&#39;aggregation_fn&#39;: &#39;maximum&#39;,
  &#39;feature_name&#39;: &#39;synth_predictor_float&#39;,
  &#39;lookbehind_days&#39;: LookPeriod(min_days=365.0, max_days=730.0)},
 {&#39;aggregation_fn&#39;: &#39;mean&#39;,
  &#39;feature_name&#39;: &#39;synth_predictor_float&#39;,
  &#39;lookbehind_days&#39;: LookPeriod(min_days=0, max_days=1095.0)},
 {&#39;aggregation_fn&#39;: &#39;maximum&#39;,
  &#39;feature_name&#39;: &#39;synth_predictor_float&#39;,
  &#39;lookbehind_days&#39;: LookPeriod(min_days=0, max_days=1095.0)}]
</pre></div>
</div>
</div>
</div>
<p>Now we know how to create a bunch of feature specifications quickly! But with more features comes more computation. Let’s look at caching next, so we can iterate on our datasets more quickly.</p>
</section>
<section id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Permalink to this heading">#</a></h2>
<p>Timeseriesflattener ships with a class that allows for caching to disk. Let’s look at an example of that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skimpy</span> <span class="kn">import</span> <span class="n">skim</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.testing.load_synth_data</span> <span class="kn">import</span> <span class="n">load_synth_prediction_times</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.feature_cache.cache_to_disk</span> <span class="kn">import</span> <span class="n">DiskCache</span>
<span class="kn">from</span> <span class="nn">timeseriesflattener.flattened_dataset</span> <span class="kn">import</span> <span class="n">TimeseriesFlattener</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_flattener</span> <span class="o">=</span> <span class="n">TimeseriesFlattener</span><span class="p">(</span>
    <span class="n">prediction_times_df</span><span class="o">=</span><span class="n">load_synth_prediction_times</span><span class="p">(),</span>
    <span class="n">entity_id_col_name</span><span class="o">=</span><span class="s2">&quot;entity_id&quot;</span><span class="p">,</span>
    <span class="n">timestamp_col_name</span><span class="o">=</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span>
    <span class="n">n_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">cache</span><span class="o">=</span><span class="n">DiskCache</span><span class="p">(</span>
        <span class="n">feature_cache_dir</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.tmp&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;feature_cache&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">drop_pred_times_with_insufficient_look_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>All we need to specify is that we use the DiskCache class, and which directory to save the feature cache to.</p>
<p>The first time we create features, this will just save them to disk and won’t make any difference to performance. But say we want to add two more features - then it’ll load the features that it has already computed from disk, and then only compute the two new features.</p>
<p>Note that DiskCache is an instance of the abstract class FeatureCache. If you want to implement your own cache, for example using REDIS or SQL, all you’ll need is to implement the 3 methods in that class. Now, let’s compute a dataframe to check that everything works.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts_flattener</span><span class="o">.</span><span class="n">add_spec</span><span class="p">(</span><span class="n">pred_spec_batch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">ts_flattener</span><span class="o">.</span><span class="n">get_df</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] There were unprocessed specs, computing...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] _drop_pred_time_if_insufficient_look_distance: Dropped 6053 (60.53%) rows
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] Processing 6 temporal features in parallel with 4 workers. Chunksize is 2. If this is above 1, it may take some time for the progress bar to move, as processing is batched. However, this makes for much faster total performance.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/6 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 1/6 [00:00&lt;00:00,  8.75it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 6/6 [00:00&lt;00:00, 41.75it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] Checking alignment of dataframes - this might take a little while (~2 minutes for 1.000 dataframes with 2.000.000 rows).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] Starting concatenation. Will take some time on performant systems, e.g. 30s for 100 features and 2_000_000 prediction times. This is normal.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] Concatenation took 0.006 seconds
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-01-23 09:03:15 [INFO] Merging with original df
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">╭──────────────────────────────────────────────── skimpy summary ─────────────────────────────────────────────────╮
│ <span style="font-style: italic">         Data Summary         </span> <span style="font-style: italic">      Data Types       </span>                                                          │
│ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓ ┏━━━━━━━━━━━━━┳━━━━━━━┓                                                          │
│ ┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> dataframe         </span>┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Values </span>┃ ┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Column Type </span>┃<span style="color: #008080; text-decoration-color: #008080; font-weight: bold"> Count </span>┃                                                          │
│ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩ ┡━━━━━━━━━━━━━╇━━━━━━━┩                                                          │
│ │ Number of rows    │ 3947   │ │ float64     │ 6     │                                                          │
│ │ Number of columns │ 9      │ │ int64       │ 1     │                                                          │
│ └───────────────────┴────────┘ │ datetime64  │ 1     │                                                          │
│                                │ string      │ 1     │                                                          │
│                                └─────────────┴───────┘                                                          │
│ <span style="font-style: italic">                                                    number                                                    </span>  │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━┳━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━┳━━━━━━━━┓  │
│ ┃<span style="font-weight: bold"> column_name             </span>┃<span style="font-weight: bold"> NA   </span>┃<span style="font-weight: bold"> NA %   </span>┃<span style="font-weight: bold"> mean  </span>┃<span style="font-weight: bold"> sd    </span>┃<span style="font-weight: bold"> p0      </span>┃<span style="font-weight: bold"> p25   </span>┃<span style="font-weight: bold"> p50   </span>┃<span style="font-weight: bold"> p75   </span>┃<span style="font-weight: bold"> p100  </span>┃<span style="font-weight: bold"> hist   </span>┃  │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━╇━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━╇━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">entity_id              </span> │ <span style="color: #008080; text-decoration-color: #008080">   0</span> │ <span style="color: #008080; text-decoration-color: #008080">     0</span> │ <span style="color: #008080; text-decoration-color: #008080"> 5000</span> │ <span style="color: #008080; text-decoration-color: #008080"> 2900</span> │ <span style="color: #008080; text-decoration-color: #008080">      0</span> │ <span style="color: #008080; text-decoration-color: #008080"> 2600</span> │ <span style="color: #008080; text-decoration-color: #008080"> 4900</span> │ <span style="color: #008080; text-decoration-color: #008080"> 7400</span> │ <span style="color: #008080; text-decoration-color: #008080">10000</span> │ <span style="color: #008000; text-decoration-color: #008000">▇▇▇▇▇▇</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">pred_synth_predictor_fl</span> │ <span style="color: #008080; text-decoration-color: #008080"> 533</span> │ <span style="color: #008080; text-decoration-color: #008080">  13.5</span> │ <span style="color: #008080; text-decoration-color: #008080">  6.6</span> │ <span style="color: #008080; text-decoration-color: #008080">  2.6</span> │ <span style="color: #008080; text-decoration-color: #008080"> 0.0084</span> │ <span style="color: #008080; text-decoration-color: #008080">  4.8</span> │ <span style="color: #008080; text-decoration-color: #008080">  7.3</span> │ <span style="color: #008080; text-decoration-color: #008080">  8.8</span> │ <span style="color: #008080; text-decoration-color: #008080">   10</span> │ <span style="color: #008000; text-decoration-color: #008000">▁▂▃▃▆▇</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">oat_within_365_days_max</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">imum_fallback_nan      </span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">pred_synth_predictor_fl</span> │ <span style="color: #008080; text-decoration-color: #008080"> 533</span> │ <span style="color: #008080; text-decoration-color: #008080">  13.5</span> │ <span style="color: #008080; text-decoration-color: #008080">    5</span> │ <span style="color: #008080; text-decoration-color: #008080">  2.1</span> │ <span style="color: #008080; text-decoration-color: #008080"> 0.0084</span> │ <span style="color: #008080; text-decoration-color: #008080">  3.6</span> │ <span style="color: #008080; text-decoration-color: #008080">    5</span> │ <span style="color: #008080; text-decoration-color: #008080">  6.4</span> │ <span style="color: #008080; text-decoration-color: #008080">  9.9</span> │ <span style="color: #008000; text-decoration-color: #008000">▂▅▇▇▅▂</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">oat_within_365_days_mea</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">n_fallback_nan         </span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">pred_synth_predictor_fl</span> │ <span style="color: #008080; text-decoration-color: #008080">   7</span> │ <span style="color: #008080; text-decoration-color: #008080">  0.18</span> │ <span style="color: #008080; text-decoration-color: #008080">    5</span> │ <span style="color: #008080; text-decoration-color: #008080">  1.3</span> │ <span style="color: #008080; text-decoration-color: #008080">   0.29</span> │ <span style="color: #008080; text-decoration-color: #008080">  4.1</span> │ <span style="color: #008080; text-decoration-color: #008080">    5</span> │ <span style="color: #008080; text-decoration-color: #008080">  5.8</span> │ <span style="color: #008080; text-decoration-color: #008080">  9.9</span> │ <span style="color: #008000; text-decoration-color: #008000"> ▂▇▇▁ </span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">oat_within_1095_days_me</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">an_fallback_nan        </span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">pred_synth_predictor_fl</span> │ <span style="color: #008080; text-decoration-color: #008080"> 506</span> │ <span style="color: #008080; text-decoration-color: #008080"> 12.82</span> │ <span style="color: #008080; text-decoration-color: #008080">  6.6</span> │ <span style="color: #008080; text-decoration-color: #008080">  2.6</span> │ <span style="color: #008080; text-decoration-color: #008080">  0.024</span> │ <span style="color: #008080; text-decoration-color: #008080">  4.8</span> │ <span style="color: #008080; text-decoration-color: #008080">  7.3</span> │ <span style="color: #008080; text-decoration-color: #008080">  8.8</span> │ <span style="color: #008080; text-decoration-color: #008080">   10</span> │ <span style="color: #008000; text-decoration-color: #008000">▂▂▃▃▆▇</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">oat_within_365_to_730_d</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">ays_maximum_fallback_na</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">n                      </span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">pred_synth_predictor_fl</span> │ <span style="color: #008080; text-decoration-color: #008080"> 506</span> │ <span style="color: #008080; text-decoration-color: #008080"> 12.82</span> │ <span style="color: #008080; text-decoration-color: #008080">  5.1</span> │ <span style="color: #008080; text-decoration-color: #008080">  2.2</span> │ <span style="color: #008080; text-decoration-color: #008080">  0.024</span> │ <span style="color: #008080; text-decoration-color: #008080">  3.6</span> │ <span style="color: #008080; text-decoration-color: #008080">    5</span> │ <span style="color: #008080; text-decoration-color: #008080">  6.5</span> │ <span style="color: #008080; text-decoration-color: #008080">   10</span> │ <span style="color: #008000; text-decoration-color: #008000">▂▅▇▇▅▂</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">oat_within_365_to_730_d</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">ays_mean_fallback_nan  </span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">pred_synth_predictor_fl</span> │ <span style="color: #008080; text-decoration-color: #008080">   7</span> │ <span style="color: #008080; text-decoration-color: #008080">  0.18</span> │ <span style="color: #008080; text-decoration-color: #008080">  8.4</span> │ <span style="color: #008080; text-decoration-color: #008080">  1.5</span> │ <span style="color: #008080; text-decoration-color: #008080">   0.29</span> │ <span style="color: #008080; text-decoration-color: #008080">  7.8</span> │ <span style="color: #008080; text-decoration-color: #008080">  8.9</span> │ <span style="color: #008080; text-decoration-color: #008080">  9.5</span> │ <span style="color: #008080; text-decoration-color: #008080">   10</span> │ <span style="color: #008000; text-decoration-color: #008000">   ▁▃▇</span> │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">oat_within_1095_days_ma</span> │      │        │       │       │         │       │       │       │       │        │  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">ximum_fallback_nan     </span> │      │        │       │       │         │       │       │       │       │        │  │
│ └─────────────────────────┴──────┴────────┴───────┴───────┴─────────┴───────┴───────┴───────┴───────┴────────┘  │
│ <span style="font-style: italic">                                                   datetime                                                   </span>  │
│ ┏━━━━━━━━━━━━━━━━━━┳━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┓  │
│ ┃<span style="font-weight: bold"> column_name      </span>┃<span style="font-weight: bold"> NA   </span>┃<span style="font-weight: bold"> NA %    </span>┃<span style="font-weight: bold"> first                      </span>┃<span style="font-weight: bold"> last                       </span>┃<span style="font-weight: bold"> frequency    </span>┃  │
│ ┡━━━━━━━━━━━━━━━━━━╇━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">timestamp       </span> │ <span style="color: #008080; text-decoration-color: #008080">   0</span> │ <span style="color: #008080; text-decoration-color: #008080">      0</span> │ <span style="color: #800000; text-decoration-color: #800000">   1968-01-02 05:12:00    </span> │ <span style="color: #800000; text-decoration-color: #800000">   1969-12-31 21:42:00    </span> │ <span style="color: #af87ff; text-decoration-color: #af87ff">None        </span> │  │
│ └──────────────────┴──────┴─────────┴────────────────────────────┴────────────────────────────┴──────────────┘  │
│ <span style="font-style: italic">                                                    string                                                    </span>  │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┓  │
│ ┃<span style="font-weight: bold"> column_name                           </span>┃<span style="font-weight: bold"> NA    </span>┃<span style="font-weight: bold"> NA %      </span>┃<span style="font-weight: bold"> words per row            </span>┃<span style="font-weight: bold"> total words         </span>┃  │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━┩  │
│ │ <span style="color: #af87ff; text-decoration-color: #af87ff">prediction_time_uuid                 </span> │ <span style="color: #008080; text-decoration-color: #008080">    0</span> │ <span style="color: #008080; text-decoration-color: #008080">        0</span> │ <span style="color: #008080; text-decoration-color: #008080">                       1</span> │ <span style="color: #008080; text-decoration-color: #008080">               3947</span> │  │
│ └───────────────────────────────────────┴───────┴───────────┴──────────────────────────┴─────────────────────┘  │
╰────────────────────────────────────────────────────── End ──────────────────────────────────────────────────────╯
</pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;entity_id&#39;,
 &#39;timestamp&#39;,
 &#39;prediction_time_uuid&#39;,
 &#39;pred_synth_predictor_float_within_365_days_maximum_fallback_nan&#39;,
 &#39;pred_synth_predictor_float_within_365_days_mean_fallback_nan&#39;,
 &#39;pred_synth_predictor_float_within_1095_days_mean_fallback_nan&#39;,
 &#39;pred_synth_predictor_float_within_365_to_730_days_maximum_fallback_nan&#39;,
 &#39;pred_synth_predictor_float_within_365_to_730_days_mean_fallback_nan&#39;,
 &#39;pred_synth_predictor_float_within_1095_days_maximum_fallback_nan&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For displayability, shorten col names</span>
<span class="n">pred_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;pred_&quot;</span><span class="p">)]</span>
<span class="n">rename_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;pred_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_cols</span><span class="p">)}</span>
<span class="n">df_renamed</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">rename_dict</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Print a dataframe</span>
<span class="n">base_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction_time_uuid&quot;</span><span class="p">]</span>
<span class="n">renamed_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rename_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">df_renamed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">][</span><span class="n">base_cols</span> <span class="o">+</span> <span class="n">renamed_cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_attributes</span><span class="p">(</span>
    <span class="s1">&#39;style=&quot;font-size: 14px&quot;&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ImportError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">base_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;entity_id&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction_time_uuid&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">renamed_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rename_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="n">df_renamed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">][</span><span class="n">base_cols</span> <span class="o">+</span> <span class="n">renamed_cols</span><span class="p">]</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_attributes</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="s1">&#39;style=&quot;font-size: 14px&quot;&#39;</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">)</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/pandas/core/frame.py:1338,</span> in <span class="ni">DataFrame.style</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1318</span> <span class="nd">@property</span>
<span class="g g-Whitespace">   </span><span class="mi">1319</span> <span class="k">def</span> <span class="nf">style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Styler</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1320</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1321</span><span class="sd">     Returns a Styler object.</span>
<span class="g g-Whitespace">   </span><span class="mi">1322</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1336</span><span class="sd">     `Table Visualization &lt;../../user_guide/style.ipynb&gt;`_ for more examples.</span>
<span class="g g-Whitespace">   </span><span class="mi">1337</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1338</span>     <span class="kn">from</span> <span class="nn">pandas.io.formats.style</span> <span class="kn">import</span> <span class="n">Styler</span>
<span class="g g-Whitespace">   </span><span class="mi">1340</span>     <span class="k">return</span> <span class="n">Styler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="n">File</span> <span class="o">~/.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">pandas</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">formats</span><span class="o">/</span><span class="n">style</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">44</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> <span class="kn">from</span> <span class="nn">pandas.core.shared_docs</span> <span class="kn">import</span> <span class="n">_shared_docs</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> <span class="kn">from</span> <span class="nn">pandas.io.formats.format</span> <span class="kn">import</span> <span class="n">save_to_buffer</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="n">jinja2</span> <span class="o">=</span> <span class="n">import_optional_dependency</span><span class="p">(</span><span class="s2">&quot;jinja2&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;DataFrame.style requires jinja2.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="kn">from</span> <span class="nn">pandas.io.formats.style_render</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="n">CSSProperties</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="n">CSSStyles</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>     <span class="n">refactor_levels</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> <span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>

<span class="nn">File ~/.local/lib/python3.10/site-packages/pandas/compat/_optional.py:161,</span> in <span class="ni">import_optional_dependency</span><span class="nt">(name, extra, errors, min_version)</span>
<span class="g g-Whitespace">    </span><span class="mi">159</span>             <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">160</span>         <span class="k">elif</span> <span class="n">errors</span> <span class="o">==</span> <span class="s2">&quot;raise&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">161</span>             <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">163</span> <span class="k">return</span> <span class="n">module</span>

<span class="ne">ImportError</span>: Pandas requires version &#39;3.1.2&#39; or newer of &#39;jinja2&#39; (version &#39;3.0.3&#39; currently installed).
</pre></div>
</div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="03_text.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Adding text features</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="01_basic.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Introductory Tutorial</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/Aarhus-Psychiatry-Research/timeseriesflattener" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Advanced Tutorial</a><ul>
<li><a class="reference internal" href="#creating-feature-combinations">Creating feature combinations</a></li>
<li><a class="reference internal" href="#caching">Caching</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    </body>
</html>